<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillPlayer - Video Learning</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <!-- App Mode Tabs (top of sidebar header) -->
            <div class="app-mode-tabs">
                <button class="app-mode-tab active" data-mode="skillplayer" onclick="switchAppMode('skillplayer')">
                    <span class="mode-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                            viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1zm0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5v11.5z" />
                        </svg></span> SkillPlayer
                </button>
                <button class="app-mode-tab" data-mode="quiz" onclick="switchAppMode('quiz')">
                    <span class="mode-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                            viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z" />
                        </svg></span> Quiz
                </button>
            </div>

            <!-- SkillPlayer Sidebar Content -->
            <div id="skillplayer-sidebar" class="sidebar-mode-content active">
                <div class="sidebar-header">
                    <h1><img src="/static/TDLogo.png" alt="Logo" class="header-logo"> SkillPlayer</h1>
                </div>
                <div class="category-tabs" id="category-tabs">
                    <!-- Categories populated by JavaScript -->
                </div>
                <nav class="skills-nav">
                    <h2 id="category-title">Skills</h2>
                    <ul id="skills-list" class="skills-list">
                        <!-- Skills populated by JavaScript -->
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <p>Views: <span id="total-views">0</span></p>
                </div>
            </div>

            <!-- Quiz Sidebar Content (Leaderboard) -->
            <div id="quiz-sidebar" class="sidebar-mode-content">
                <div class="sidebar-header quiz-header">
                    <h1><span class="mode-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2zM5 8V7h2v3.82C5.84 10.4 5 9.3 5 8zm14 0c0 1.3-.84 2.4-2 2.82V7h2v1z" />
                            </svg></span> Leaderboard</h1>
                </div>
                <div class="quiz-leaderboard-panel">
                    <div id="sidebar-scores-list" class="scores-list">
                        <!-- Leaderboard populated by JavaScript -->
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Mode Switch Hint -->
            <div class="mode-switch-hint">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="#ff4444">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
                <span>Switch between SkillPlayer and Quiz</span>

            </div>
            <!-- SkillPlayer Mode Content -->
            <div id="skillplayer-content" class="app-mode-content active">
                <!-- Video Player Section -->
                <section class="video-section" id="video-section">
                    <div class="video-container" id="video-container">
                        <div class="video-placeholder" id="video-placeholder">
                            <div class="placeholder-content">
                                <img src="/static/TDLogo.png" alt="Logo" class="placeholder-logo">
                                <h2 class="placeholder-text-red">Select a category and topic from the left and find
                                    related
                                    videos and training bulletins below:</h2>
                                <p class="placeholder-text-french">S√©lectionnez une cat√©gorie et un sujet √† gauche et
                                    trouvez les vid√©os et bulletins de formation associ√©s ci-dessous:</p>
                            </div>
                            <div class="placeholder-arrow" id="placeholder-arrow">
                                <!-- Arrow pointing left (to sidebar) when no skill selected -->
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ff4444" width="80"
                                    height="80">
                                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                                </svg>
                            </div>
                        </div>
                        <video id="video-player" class="video-player" controls style="display: none;">
                            Your browser does not support the video tag.
                        </video>
                        <iframe id="pdf-viewer" class="pdf-viewer" style="display: none; border: none;"></iframe>
                    </div>
                    <div class="video-title" id="video-title"></div>
                </section>

                <!-- Videos List Section -->
                <section class="videos-list-section" id="videos-section">
                    <h2><span id="current-skill-title">Select a topic to see videos</span> <span
                            id="current-skill-title-french" class="skill-title-french">/ S√©lectionnez un sujet pour voir
                            les
                            vid√©os</span></h2>
                    <div class="videos-grid" id="videos-grid">
                        <!-- Videos populated by JavaScript -->
                    </div>
                </section>
            </div>

            <!-- Quiz Mode Content -->
            <div id="quiz-content" class="app-mode-content">
                <div class="quiz-container">
                    <!-- Start Screen -->
                    <div id="quiz-start-screen" class="quiz-screen active">
                        <div class="quiz-logo">
                            <span class="quiz-logo-icon"><svg xmlns="http://www.w3.org/2000/svg" width="72" height="72"
                                    viewBox="0 0 24 24" fill="url(#quizGradient)">
                                    <defs>
                                        <linearGradient id="quizGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#6366f1" />
                                            <stop offset="100%" style="stop-color:#a855f7" />
                                        </linearGradient>
                                    </defs>
                                    <path
                                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z" />
                                </svg></span>
                            <h1>Quiz Challenge</h1>
                        </div>
                        <p class="quiz-tagline">Test your knowledge in 1 minute!</p>
                        <!-- Selector Moved Above Rules -->
                        <div class="player-mode-selector" style="margin-bottom: 20px;">
                            <label class="mode-option">
                                <input type="radio" name="player-mode" value="1" checked onchange="updateQuizRules(1)">
                                <span class="mode-label">1 Player</span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="player-mode" value="2" onchange="updateQuizRules(2)">
                                <span class="mode-label">2 Players</span>
                            </label>
                        </div>

                        <div id="quiz-rules-1p" class="quiz-rules">
                            <div class="quiz-rule"><span class="rule-icon"><svg xmlns="http://www.w3.org/2000/svg"
                                        width="20" height="20" viewBox="0 0 24 24" fill="#3b82f6">
                                        <path
                                            d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
                                    </svg></span> 1 minute time limit</div>
                            <div class="quiz-rule"><span class="rule-icon"><svg xmlns="http://www.w3.org/2000/svg"
                                        width="20" height="20" viewBox="0 0 24 24" fill="#22c55e">
                                        <path
                                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                    </svg></span> +2 seconds for correct answers</div>
                            <div class="quiz-rule"><span class="rule-icon"><svg xmlns="http://www.w3.org/2000/svg"
                                        width="20" height="20" viewBox="0 0 24 24" fill="#ef4444">
                                        <path
                                            d="M19 6.41L17.59 5 12 10.59 6.41 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                                    </svg></span> -5 seconds for wrong answers</div>
                        </div>

                        <div id="quiz-rules-2p" class="quiz-rules hidden">
                            <div class="quiz-rule"><span class="rule-icon">üèÜ</span> Compete for highest score</div>
                            <div class="quiz-rule"><span class="rule-icon">‚è±Ô∏è</span> +2 seconds for correct answers
                            </div>
                            <div class="quiz-rule"><span class="rule-icon">üîí</span> Wrong answer = 3s Lockout</div>
                        </div>

                        <!-- Moved Input Mode Toggle -->
                        <div class="input-mode-toggle" id="input-mode-toggle" style="margin-bottom: 2rem;">
                            <button class="input-toggle-btn active" data-mode="mouse" onclick="setInputMode('mouse')"
                                title="Mouse Mode">
                                <img src="/static/ui_mouse.png" alt="Mouse">
                                Mouse
                            </button>
                            <button class="input-toggle-btn" data-mode="gamepad" onclick="setInputMode('gamepad')"
                                title="Gamepad Mode">
                                <img src="/static/ui_gamepad.png" alt="Gamepad">
                                Gamepad
                            </button>
                        </div>
                        <button id="quiz-start-btn" class="quiz-btn-primary" onclick="startQuiz()">Start Quiz</button>
                    </div>

                    <!-- Gamepad Binding Screen -->
                    <div id="quiz-binding-screen" class="quiz-screen">
                        <div class="binding-container">
                            <div class="binding-icon">
                                <img src="/static/ui_gamepad_clean.png" alt="Gamepad"
                                    style="width: 120px; height: auto;">
                            </div>
                            <h2 class="binding-title">Press Any Button to Start</h2>
                            <p class="binding-subtitle">The first gamepad to press will control this quiz</p>
                            <p id="binding-status-text" class="binding-status"
                                style="margin-bottom: 20px; color: yellow;">Waiting for gamepads...</p>
                            <div class="binding-pulse"></div>

                            <button id="binding-cancel-btn" class="quiz-btn-secondary"
                                style="margin-top: 40px; width: auto; position: relative; z-index: 10;"
                                onclick="cancelBinding()">
                                Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Countdown Screen -->
                    <div id="quiz-countdown-screen" class="quiz-screen">
                        <div class="countdown-container">
                            <p class="countdown-message">You have one minute to answer as many questions as you can!</p>
                            <div id="countdown-number" class="countdown-number">3</div>
                        </div>
                    </div>

                    <!-- Game Screen -->
                    <div id="quiz-game-screen" class="quiz-screen">
                        <div class="quiz-game-header">
                            <!-- Player 1 Score (2P Mode) -->
                            <div id="p1-score-container" class="player-score-container hidden">
                                <div id="p1-lock-bar" class="lockout-bar hidden">üîí LOCKED</div>
                                <div class="player-info-row">
                                    <span class="player-badge p1">P1</span>
                                    <span id="p1-timer" class="player-timer">60</span>
                                </div>
                                <span id="p1-score-val" class="player-score-val">0</span>
                                <div id="p1-streak" class="player-streak hidden">üî• 0</div>
                                <div id="p1-lock-overlay" class="lock-overlay hidden">üîí</div>
                                <div id="p1-feedback" class="player-feedback"></div>
                            </div>

                            <div class="quiz-controls-center">
                                <div class="volume-control">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="currentColor" class="volume-icon">
                                        <path
                                            d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
                                    </svg>
                                    <input type="range" id="quiz-volume" min="0" max="1" step="0.1" value="0.5"
                                        onchange="updateVolume(this.value)" oninput="updateVolume(this.value)">
                                </div>
                                <div class="quiz-timer-container">
                                    <div class="quiz-timer-bar">
                                        <div id="quiz-timer-fill" class="quiz-timer-fill"></div>
                                    </div>
                                    <div class="timer-text-wrapper">
                                        <span id="quiz-timer-text" class="quiz-timer-text">3:00</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Single Player Score (Default) -->
                            <div id="single-player-score-container" class="quiz-score-display">
                                Score: <span id="quiz-score">0</span>
                                <span id="floating-score" class="floating-score"></span>
                            </div>

                            <!-- Player 2 Score (2P Mode) -->
                            <div id="p2-score-container" class="player-score-container hidden">
                                <div id="p2-lock-bar" class="lockout-bar hidden">üîí LOCKED</div>
                                <div class="player-info-row">
                                    <span class="player-badge p2">P2</span>
                                    <span id="p2-timer" class="player-timer">60</span>
                                </div>
                                <span id="p2-score-val" class="player-score-val">0</span>
                                <div id="p2-streak" class="player-streak hidden">üî• 0</div>
                                <div id="p2-lock-overlay" class="lock-overlay hidden">üîí</div>
                                <div id="p2-feedback" class="player-feedback"></div>
                            </div>
                        </div>

                        <div class="quiz-question-container">
                            <div class="quiz-question-number">Question <span id="quiz-question-num">1</span> / <span
                                    id="quiz-total-questions">15</span></div>
                            <h2 id="quiz-question-text" class="quiz-question-text"></h2>
                        </div>

                        <div class="quiz-game-area">
                            <div id="quiz-answers-container" class="quiz-answers-container">
                                <!-- Answer buttons will be inserted here -->
                            </div>
                            <div class="quiz-skip-container">
                                <button id="quiz-skip-btn" class="quiz-btn-skip skip-hidden" onclick="skipQuestion()">
                                    <div class="rb-icon">RB</div> SKIP
                                </button>
                            </div>
                        </div>

                        <div id="quiz-feedback" class="quiz-feedback"></div>

                        <!-- Streak Indicator -->
                        <div id="streak-indicator" class="streak-indicator hidden">
                            <div class="streak-star">
                                <svg class="streak-ring" viewBox="0 0 36 36">
                                    <circle class="streak-ring-bg" cx="18" cy="18" r="16"></circle>
                                    <circle id="streak-ring-progress" class="streak-ring-progress" cx="18" cy="18"
                                        r="16"></circle>
                                </svg>
                                <svg class="star-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                </svg>
                            </div>
                            <span id="streak-text" class="streak-text">Streak!</span>
                        </div>

                        <!-- Steal Indicator (Clone of Streak) -->
                        <div id="steal-indicator" class="streak-indicator hidden steal-mode">
                            <div class="streak-star">
                                <svg class="streak-ring" viewBox="0 0 36 36">
                                    <circle class="streak-ring-bg" cx="18" cy="18" r="16"></circle>
                                    <circle id="steal-ring-progress" class="streak-ring-progress" cx="18" cy="18"
                                        r="16"></circle>
                                </svg>
                                <!-- Hand/Grab Icon for Steal -->
                                <svg class="star-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M21 11h-4.3c-1.3 0-2.5-.7-3.1-1.8-.7-1.3-.7-2.9 0-4.2l.4-.7c.3-.5.3-1.1-.1-1.6-.4-.4-1.1-.5-1.6-.1l-1.6 1.1c-1.1.8-2.6.9-3.8.3C5.7 3.5 5 2.1 5.3 1c.1-.4-.1-.8-.5-.9-.4-.1-.8.1-.9.5C3.3 2.1 3 3.6 3 5v14c0 1.1.9 2 2 2h8l1-1h5c1.1 0 2-.9 2-2v-5c0-1.1-.9-2-2-2z" />
                                </svg>
                            </div>
                            <span id="steal-text" class="streak-text">STEAL!</span>
                        </div>

                        <div class="quiz-stop-container">
                            <div class="stop-btn-wrapper">
                                <button id="quiz-btn-stop" class="quiz-btn-stop" onclick="stopQuizAttempt()">
                                    <div id="stop-progress" class="stop-progress"></div>
                                    <span class="stop-label">Stop Attempt</span>
                                </button>
                                <span class="stop-hint">Hold START (2s)</span>
                            </div>
                        </div>
                    </div>

                    <!-- End Screen -->
                    <div id="quiz-end-screen" class="quiz-screen">
                        <h1 class="quiz-end-title">Time's Up!</h1>

                        <!-- Two-column layout: leaderboard left, score+entry right -->
                        <div class="quiz-end-row">
                            <!-- Mini Leaderboard on End Screen (left side) -->
                            <div id="quiz-end-leaderboard" class="quiz-end-leaderboard">
                                <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="#f59e0b" style="vertical-align: middle;">
                                        <path
                                            d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2zM5 8V7h2v3.82C5.84 10.4 5 9.3 5 8zm14 0c0 1.3-.84 2.4-2 2.82V7h2v1z" />
                                    </svg> Leaderboard</h2>
                                <div id="quiz-end-scores-list" class="scores-list">
                                    <!-- Scores will be inserted here -->
                                </div>
                            </div>

                            <!-- Right column: Score + Name Entry -->
                            <div class="quiz-end-right">
                                <div class="quiz-final-score">
                                    <span class="quiz-score-label">Your Score</span>
                                    <span id="quiz-final-score" class="quiz-score-value">0</span>
                                </div>

                                <!-- Name Entry (shown if top 10) -->
                                <div id="quiz-name-entry" class="quiz-name-entry hidden">
                                    <h2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="#22c55e" style="vertical-align: middle;">
                                            <path
                                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                        </svg> Top 10 Score! <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                            height="24" viewBox="0 0 24 24" fill="#22c55e"
                                            style="vertical-align: middle;">
                                            <path
                                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                        </svg></h2>
                                    <p>Click letters to enter your name (10 characters max):</p>
                                    <input type="text" id="quiz-player-name" maxlength="10" placeholder="NAME"
                                        autocomplete="off" readonly>

                                    <!-- Virtual Keyboard -->
                                    <div class="virtual-keyboard" id="virtual-keyboard">
                                        <div class="keyboard-row">
                                            <button class="key" onclick="pressKey('Q')">Q</button>
                                            <button class="key" onclick="pressKey('W')">W</button>
                                            <button class="key" onclick="pressKey('E')">E</button>
                                            <button class="key" onclick="pressKey('R')">R</button>
                                            <button class="key" onclick="pressKey('T')">T</button>
                                            <button class="key" onclick="pressKey('Y')">Y</button>
                                            <button class="key" onclick="pressKey('U')">U</button>
                                            <button class="key" onclick="pressKey('I')">I</button>
                                            <button class="key" onclick="pressKey('O')">O</button>
                                            <button class="key" onclick="pressKey('P')">P</button>
                                        </div>
                                        <div class="keyboard-row">
                                            <button class="key" onclick="pressKey('A')">A</button>
                                            <button class="key" onclick="pressKey('S')">S</button>
                                            <button class="key" onclick="pressKey('D')">D</button>
                                            <button class="key" onclick="pressKey('F')">F</button>
                                            <button class="key" onclick="pressKey('G')">G</button>
                                            <button class="key" onclick="pressKey('H')">H</button>
                                            <button class="key" onclick="pressKey('J')">J</button>
                                            <button class="key" onclick="pressKey('K')">K</button>
                                            <button class="key" onclick="pressKey('L')">L</button>
                                        </div>
                                        <div class="keyboard-row">
                                            <button class="key" onclick="pressKey('Z')">Z</button>
                                            <button class="key" onclick="pressKey('X')">X</button>
                                            <button class="key" onclick="pressKey('C')">C</button>
                                            <button class="key" onclick="pressKey('V')">V</button>
                                            <button class="key" onclick="pressKey('B')">B</button>
                                            <button class="key" onclick="pressKey('N')">N</button>
                                            <button class="key" onclick="pressKey('M')">M</button>
                                            <button class="key key-backspace" onclick="pressBackspace()">‚å´ DEL</button>
                                        </div>
                                    </div>

                                    <button id="quiz-submit-score-btn" class="quiz-btn-primary"
                                        onclick="submitQuizScore()">Submit Score</button>
                                    <button id="quiz-skip-name-btn" class="quiz-btn-secondary"
                                        onclick="skipNameEntry()">No thank you</button>

                                </div>
                                <button id="quiz-play-again-btn" class="quiz-btn-primary"
                                    onclick="showQuizStartScreen()">Play Again</button>
                            </div>

                        </div>
                    </div>

                    <!-- Calibration Level Selector Screen -->
                    <div id="calibration-level-screen" class="quiz-screen">
                        <div class="calibration-header-banner">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                            </svg>
                            CALIBRATION MODE
                        </div>
                        <h2 style="margin-bottom: 20px;">Select Calibration Level</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 30px;">
                            Questions with calibration level BELOW your selection will be shown.
                        </p>
                        <div class="calibration-level-buttons">
                            <button class="calibration-level-btn" onclick="selectCalibrationLevel(1)">Level 1</button>
                            <button class="calibration-level-btn" onclick="selectCalibrationLevel(2)">Level 2</button>
                            <button class="calibration-level-btn" onclick="selectCalibrationLevel(3)">Level 3</button>
                            <button class="calibration-level-btn" onclick="selectCalibrationLevel(4)">Level 4</button>
                            <button class="calibration-level-btn" onclick="selectCalibrationLevel(5)">Level 5</button>
                        </div>
                        <!-- Input Mode Toggle for Calibration -->
                        <div class="input-mode-toggle" style="margin-top: 30px;">
                            <button class="input-toggle-btn active" data-mode="mouse" onclick="setInputMode('mouse')"
                                title="Mouse Mode">
                                <img src="/static/ui_mouse.png" alt="Mouse">
                                Mouse
                            </button>
                            <button class="input-toggle-btn" data-mode="gamepad" onclick="setInputMode('gamepad')"
                                title="Gamepad Mode">
                                <img src="/static/ui_gamepad.png" alt="Gamepad">
                                Gamepad
                            </button>
                        </div>
                        <button id="calibration-start-btn" class="quiz-btn-primary disabled" style="margin-top: 20px;"
                            onclick="confirmStartCalibration()" disabled>
                            Start Calibration
                        </button>
                        <button class="quiz-btn-secondary" style="margin-top: 30px;"
                            onclick="exitCalibrationLevelScreen()">Cancel</button>
                    </div>

                    <!-- Calibration Game Screen -->
                    <div id="calibration-game-screen" class="quiz-screen">
                        <div class="calibration-header-banner">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                            </svg>
                            CALIBRATION MODE - Level <span id="calibration-level-display">1</span>
                        </div>

                        <div class="calibration-progress">
                            <span>Question <span id="calibration-question-num">1</span> / <span
                                    id="calibration-total-questions">0</span></span>
                            <span id="calibration-calibrated-count" style="color: #22c55e;">Calibrated: 0</span>
                        </div>

                        <div class="quiz-question-container">
                            <h2 id="calibration-question-text" class="quiz-question-text"></h2>
                        </div>

                        <div class="quiz-game-area calibration-layout">
                            <!-- Left: Prev Review -->
                            <button id="calibration-review-prev-btn" class="calibration-side-btn left"
                                onclick="markPreviousForReview()">
                                <div class="rb-icon lb-icon">LB</div>
                                <span>MARK PREVIOUS<br>QUESTION</span>
                            </button>

                            <!-- Center: Answers -->
                            <div id="calibration-answers-container" class="quiz-answers-container">
                                <!-- Answer buttons will be inserted here -->
                            </div>

                            <!-- Right: Review -->
                            <button id="calibration-review-btn" class="calibration-side-btn right"
                                onclick="markForReview()">
                                <div class="rb-icon">RB</div>
                                <span>MARK FOR<br>REVIEW</span>
                            </button>
                        </div>

                        <div id="calibration-feedback" class="quiz-feedback"></div>

                        <div class="calibration-end-container">
                            <button id="calibration-end-btn" class="calibration-end-btn" onclick="endCalibration()">
                                <div id="calibration-stop-progress" class="btn-progress-fill"></div>
                                <span style="position: relative; z-index: 2;">Exit Calibration (Hold Start)</span>
                            </button>
                        </div>
                    </div>

                    <!-- Flag Reason Overlay (Deprecated - keeping for compatibility) -->
                    <div id="calibration-flag-reason-overlay" class="calibration-overlay hidden">
                        <h2>Mark for Review?</h2>
                        <div class="calibration-options-grid">
                            <button class="calibration-option-btn btn-yellow" onclick="submitCalibration('review')">
                                <div class="btn-icon">‚úì</div>
                                Yes, Mark for Review
                            </button>
                            <button class="calibration-option-btn btn-green" onclick="hideFlagReasonScreen()">
                                <div class="btn-icon">‚úó</div>
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Admin Menu -->
                <div class="admin-container">
                    <div id="admin-popup" class="admin-popup hidden">
                        <h3>‚öôÔ∏è Admin Menu</h3>
                        <div class="build-timestamp">Build: {{ build_time }}</div>

                        <!-- Admin Actions -->
                        <div class="admin-actions">
                            <button class="admin-action-btn update-action" onclick="triggerUpdate()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z" />
                                </svg>
                                <span>Update & Reboot</span>
                            </button>
                            <button class="admin-action-btn reset-action" onclick="promptResetScores()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                                </svg>
                                <span>Reset All Scores</span>
                            </button>
                            <button class="admin-action-btn calibration-action" onclick="promptCalibrationPassword()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                                </svg>
                                <span>Calibration Mode</span>
                            </button>
                        </div>

                        <div class="admin-section">
                            <h3>System Logs</h3>
                            <div id="admin-log-console" class="admin-log-console">
                                <div class="log-entry system">> Ready...</div>
                            </div>
                        </div>

                        <!-- Changelog Section -->
                        <div class="admin-section">
                            <div class="admin-changelog">
                                <h4>Version History</h4>
                                <div id="changelog-list" class="changelog-list">
                                    <!-- Items injected via JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="admin-btn" class="admin-btn" onclick="toggleAdminMenu()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                        <span id="version-label">v2.1</span>
                    </button>
                </div>

                <script src="/static/socket.io.min.js"></script>
                <script src="/static/app.js"></script>
</body>

</html>